import datetime

Tareas = {"Materias":{
    "Probabilidad":{
        "PIA":{
            "Fecha de entrega": datetime.datetime(2020, 12, 7, 23, 59), 
            "Partes":[
                "Pasar tabla a estructura de datos",
                "Encontrar medidas descriptivas de centralidad y dispercion",
                "Construir una tabla de frecuencias",
                "Elaborar una grafica con los porcentajes",
                "Pasar calculos y procedimientos a Word"
            ]
        },
        "Solucion de casos 6":{
            "Fecha de entrega": datetime.datetime(2020, 12, 4, 12, 30),
            "Partes":[
                "Investigar los temas que abarcan",
                "Estudiar densidades de probabilidad especiales",
                "Reforzar conocimientos",
                "Agregar formulas a formulario",
                "Resolver mitad de la solucion de casos",
                "Terminar solucion de casos",
            ]
        },
        "Formulario":{
            "Fecha de entrega": datetime.datetime(2020, 12, 7, 12, 0),
            "Partes":[
                "Crear portada",
                "Crear layout",
                "Investigar criterios",
                "Conseguir formularios",
                "Ordenar contenido",
                "Agregar color",
                "Revisar formato"
            ]
        }
    },
    "Ecuaciones diferenciales":{
        "Tarea 7":{
            "Fecha de entrega": datetime.datetime(2020, 11, 29, 23, 59),
            "Partes":[
                "Estudiar transformadas de Laplace",
                "Resolver problema"
            ]
        },
    },
    "Circuitos Digitales":{
        "PIA":{
            "Fecha de entrega": datetime.datetime(2020, 12, 5, 12, 0),
            "Partes":[
                "Revisar Introducion, Descripcion, Diagrama, Materiales",
                "Revisar Desarrollo con la descripcion y fotografia de cada uno de los pasos",
                "Documentar el funcionamiento con dos sumas y dos restas",
                "Hacer conslusion individual y grupal",
                "Agreagar Indice, Portada, Formato",
            ]
        },
        "Evidencia 1":{
            "Fecha de entrega": datetime.datetime(2020, 11, 30, 16, 0),
            "Partes":[
                "Hacer mapa de karnaugh",
                "Simplificar 6 ecuaciones booleanas, con tablas de verdad y mapas de karnaugh",
            ]
        },
        "Evidencia 2":{
            "Fecha de entrega": datetime.datetime(2020, 12, 1, 16, 0),
            "Partes":[
                "Realizar resumen sobre sistemas combinacionales",
                "Agregar conclusiones",
                "Dar formato"
            ]
        },
        "Evidencia 3":{
            "Fecha de entrega": datetime.datetime(2020, 12, 2, 16, 0),
            "Partes":[
                "Aplicar metodologia de diseno secuencial para crear un sistema con dos estados usando un flipflop JK",
                "Aplicar metodologia de diseno secuencial para crear un sistema con dos estados usando un flipflop D",
                "Documentar los 9 pasos en un documento de Word"
            ]
        },
        "Investigacion":{
            "Fecha de entrega": datetime.datetime(2020, 12, 4, 16, 0),
            "Partes":[
                "Crear layout del documento a entregar",
                "Definir concepto memoria",
                "Definir concepto de memoria Ram",
                "Investigar caracteristicas de 9 tipos de memoria",
                "Agregar conclusiones",
                "Agregar indice, introduccion, bibliografia, dar formato"
            ]
        },
    },
    "Estructuras de Datos":{
        "PIA":{
            "Fecha de entrega": datetime.datetime(2020, 12, 6, 23, 59),
            "Partes":[
                "Revisar avances y actualizar pendientes"
            ]
        },
    },
    "Laboratorio de Aplicaciones Moviles":{
        "Practicas 11-15":{
            "Fecha de entrega": datetime.datetime(2020, 12, 8, 0, 0),
            "Partes":[
                "Realizar Practica 11",
                "Realizar Practica 12",
                "Realizar Practica 13",
                "Realizar Practica 14",
                "Realizar Practica 15",
            ]
        },
    },
    "Aplicaciones Moviles":{
        "PIA":{
            "Fecha de entrega": datetime.datetime(2020, 12, 4, 23, 59),
            "Partes":[
                {
                    "Idear un proyecto Angular":{
                        "Ideas":[
                            "Clon de reddit"
                        ],
                        "Requistos":[
                            "Debe incluir al menos 3 componentes",
                            "Usar una API Rest",
                        ]
                    }
                },
                "Tipar estructuras del proyecto en Typescript",
                "Resgauardar en git",
                "Validaciones en los formularios",
                "Documentacion funcional manual o video obligatorio"
            ]
        },
        "Tarea 4":{
            "Fecha de entrega": datetime.datetime(2020, 12, 4, 23, 59),
            "Partes":[
                "Realizar presentacion de powerpoint acerca del tema que mas me haya gustado de la materia",
                {"Ideas":[
                    "Realizar presentacion acerca de las APIs"]}
                ]
        },
        "Proyecto de innovacion tecnico":{
            "Fecha de entrega": datetime.datetime(2020, 12, 3, 23, 59),
            "Partes":[
                "Idear una aplicacion tecnologica que resuelva algun problema que surge cuando estas de viaje",
                "En que constara el proyecto",
                "Funcionalidad de la aplicación",
                "Fases del desarrollo del proyecto",
                "Arquitectura de la aplicación",
                "Diseno de vista",
                "Tecnica y herramientas",
                "Definición de la empresa, organigrama",
                "Definición de roles",
                "Historia",                    
            ]
        },
        "Proyecto de innovacion funcional":{
            "Fecha de entrega": datetime.datetime(2020, 12, 3, 23, 59),
            "Partes":[
                "Diseno de las vistas y funciones de la aplicacion",
                "Esquema de la app"
            ]
        },
    },
    "Cultura de Paz":{
        "Evidencia 3":{
            "Fecha de entrega": datetime.datetime(2020, 12, 10, 23, 59),
            "Partes":[
                "Investigar acerca de Asociación Faro en el Camino: Reinserción Social",
                "Crear layout del ensayo o resumen",
                "Desarrollar ensayo o resumen",
                "Terminar ensayo o resumen"
            ]
            },
        "Evidencia 4":{
            "Fecha de entrega": datetime.datetime(2020, 12, 10, 23, 59),
            "Partes":[
                {"Investigacion":{
                    "Identificar conflicto social; plantear la problemática.",
                    "Analizar qué estrategias se han utilizado para tratar de solucionarlo.",
                    "Hacer propuesta de estrategia de cómo lo solucionarían.",
                    "Indicar qué valores de la cultura de paz están contemplados y en qué parte de la estrategia de la propuesta están."
                }},
                "Crear layout del ensayo",
                "Desarrollar ensayo",
                "Terminar ensayo"
            ]
            },
        "Evidencia 5":{
            "Fecha de entrega": datetime.datetime(2020, 12, 7, 23, 59),
            # "Fecha de entrega": datetime.datetime(2020, 12, 10, 23, 59), #original
            "Partes":[
                "Identificar modelo de responsabilidad social",
                "Describir las acciones actuales que lleva a cabo su institución de educación superior para incluir en sus modelos educativos la educación para la paz.",
                "Identificar las áreas de oportunidad que presentan las acciones actuales de su institución.",
                "Definir idea",
                "Proponer una estrategia de mejora a favor de acciones de educación para la paz en su institución de educación superior, en concordancia con los modelos de responsabilidad social, en la que se incluyan: descripción, objetivos, alcances, impacto social y beneficios.",
                "Crear layout del ensayo",
                "Desarrollar ensayo",
                "Terminar ensayo"
            ]
        },
        "PIA":{
            "Fecha de entrega": datetime.datetime(2020, 12, 11, 23, 59),
            "Partes":[
                "Terminar evidencia 5",
                "Organizar campaña para promover la cultura de paz en el contexto local e inmediato",
                "Actualizar tareas",
                "Crear layout",
                "Desarrollar campania",
                "Terminar campania"
            ]
            },
    },
}}

def count(structure):
    if isinstance(structure, (str, datetime.datetime)):
        return 1
    
    if isinstance(structure, list):
        return len(structure)
    
    if not isinstance(structure, dict):
        print(type(structure))
        raise ValueError


    suma = 0
    for key, value in structure.items():
        suma += count(value)
    
    return suma


now = datetime.datetime(2020, 11, 28, 22, 0)
dinamic_to_do = []
for materia, tareas in Tareas["Materias"].items():
    for tarea, detalles in tareas.items():
        fecha = detalles["Fecha de entrega"]
        puntos = count(detalles["Partes"])+1
        time_left = fecha - now
        delta_t = (time_left)/puntos
        for index in range(len(detalles["Partes"])):
            dinamic_to_do.append((delta_t*(index+1)+now, detalles["Partes"][index], f"{tarea} {materia}", f"{str(time_left)}"))

for i in (sorted(dinamic_to_do, key=lambda x: x[0])):
    print(f'{i[0].strftime("%d/%m/%Y %H:%M:%S"):20}    {i[1]}  {i[2]}')

import xlsxwriter

workbook = xlsxwriter.Workbook('tareas1.xlsx')
worksheet = workbook.add_worksheet()

# row = 0
# max_rows = (ord("Z")-ord("A"))
# for tarea in (sorted(dinamic_to_do, key=lambda x: x[0])):
#     column = 0 
#     for punto in tarea:
#         column += 1
#         ascii_val = ord("A")+row
#         if ascii_val > ord("Z"):
#             letters = int((ascii_val-ord("A"))/max_rows)
#             ascii_val = ascii_val-max_rows*letters
#             print(f'{"A"}{chr(ascii_val)}{column}')
#             worksheet.write(f'{"A"}{chr(ascii_val)}{column}', "xi")
#         else:
#             print(f'{chr(ord("A")+row)}{column}')
#             pos = f'{row}{chr(ord("A")+column)}'
#             worksheet.write(pos, "xi")
#     row += 1

row = 0
max_rows = (ord("Z")-ord("A"))
for tarea in (sorted(dinamic_to_do, key=lambda x: x[0])):
    for punto in range(len(tarea)):
        ascii_val = ord("A")+punto
        pos = f'{chr(ascii_val)}{row+1}'
        if punto == 0:
            worksheet.write(pos, f'{tarea[punto].strftime("%d/%m/%Y %H:%M:%S")}')
        else:
            worksheet.write(pos, str(tarea[punto]))
    row += 1
workbook.close()